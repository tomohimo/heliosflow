<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Helios Flow - ä¿®æ­£ç‰ˆ</title>
  <style>
    :root{
      --bg:#f8fafc;
      --text:#0f172a;
      --muted:#64748b;
      --line:#cbd5e1;
      --mainline:#1f2937;
      --accent:#ef4444;
      --shadow:0 4px 12px rgba(15,23,42,.08);
      --shadowHover:0 8px 20px rgba(15,23,42,.14);
      --radius:12px;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; background:var(--bg); color:var(--text); font-family:"Inter","Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif; }
    .wrap{ height:100vh; overflow:hidden; position:relative; }
    .canvas{ position:absolute; inset:0; transform-origin:0 0; }

    .node{
      position:absolute;
      width:180px;
      padding:14px;
      background:#fff;
      border-radius:var(--radius);
      border:2px solid;
      box-shadow:var(--shadow);
      transition:transform .15s ease, box-shadow .15s ease;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      gap:6px;
      cursor:pointer;
    }
    .node:hover{
      transform:translateY(-2px) scale(1.03);
      box-shadow:var(--shadowHover);
    }

    .node-icon{
      width:28px; height:28px;
      border-radius:6px;
      display:flex; align-items:center; justify-content:center;
      font-size:15px;
      flex-shrink:0;
    }
    .node h4{
      margin:0;
      font-size:13px;
      font-weight:700;
      letter-spacing:.1px;
      position:relative;
      color:var(--text);
      line-height:1.4;
    }
    .tooltip{
      position:absolute;
      left:0; top:20px;
      background:#1e293b;
      color:#f1f5f9;
      border:1px solid #334155;
      padding:6px 8px;
      border-radius:6px;
      font-size:11px;
      white-space:nowrap;
      opacity:0;
      transform:translateY(-4px);
      pointer-events:none;
      transition:.15s;
      z-index:5;
    }
    .node h4:hover .tooltip{ opacity:1; transform:translateY(0); }

    .node.cat-contract{ border-color:#3b82f6; }
    .node.cat-contract .node-icon{ background:#dbeafe; color:#1e40af; }

    .node.cat-legal{ border-color:#f97316; }
    .node.cat-legal .node-icon{ background:#fed7aa; color:#c2410c; }

    .node.cat-milestone{ border-color:#ef4444; }
    .node.cat-milestone .node-icon{ background:#fecaca; color:#b91c1c; }

    .node.cat-procurement{ border-color:#8b5cf6; }
    .node.cat-procurement .node-icon{ background:#ede9fe; color:#6d28d9; }

    .node.cat-equipment{ border-color:#06b6d4; }
    .node.cat-equipment .node-icon{ background:#cffafe; color:#0e7490; }

    .node.cat-inspection{ border-color:#f59e0b; }
    .node.cat-inspection .node-icon{ background:#fef3c7; color:#d97706; }

    .node.cat-registration{ border-color:#10b981; }
    .node.cat-registration .node-icon{ background:#d1fae5; color:#047857; }

    .node.cat-handover{ border-color:#ec4899; }
    .node.cat-handover .node-icon{ background:#fce7f3; color:#be185d; }

    .node.cat-power{ border-color:#eab308; }
    .node.cat-power .node-icon{ background:#fef9c3; color:#a16207; }

    .node.cat-waste{ border-color:#78716c; }
    .node.cat-waste .node-icon{ background:#e7e5e4; color:#44403c; }

    svg{ position:absolute; inset:0; pointer-events:none; }

    .mainline{
      stroke:var(--mainline);
      stroke-width:4;
      fill:none;
    }

    .edge, .hanging{
      stroke:var(--line);
      stroke-width:2;
      fill:none;
      transition:stroke .2s ease;
    }

    .edge.active, .hanging.active{
      stroke:var(--accent);
      stroke-width:3;
      animation:dash .8s linear infinite;
    }

    @keyframes dash{
      to{ stroke-dashoffset:-20; }
    }

    .controls{
      position:fixed;
      top:20px; right:20px;
      display:flex; gap:8px;
      z-index:10;
    }
    .controls button{
      padding:8px 14px;
      border:1px solid #cbd5e1;
      border-radius:6px;
      background:#fff;
      cursor:pointer;
      font-size:13px;
      font-weight:600;
      transition:.15s;
    }
    .controls button:hover{ background:#f1f5f9; }

    .legend{
      position:fixed;
      bottom:20px; left:20px;
      background:#fff;
      border:1px solid #e2e8f0;
      border-radius:8px;
      padding:12px 16px;
      box-shadow:var(--shadow);
      z-index:10;
      font-size:11px;
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      max-width:800px;
    }
    .legend-item{
      display:flex;
      align-items:center;
      gap:6px;
    }
    .legend-color{
      width:16px; height:16px;
      border-radius:3px;
      border:2px solid;
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="controls">
    <button id="zoomIn">+</button>
    <button id="zoomOut">âˆ’</button>
    <button id="reset">Reset</button>
  </div>
  <div class="canvas" id="canvas">
    <svg id="edgesSvg"></svg>
  </div>
  <div class="legend">
    <div class="legend-item"><div class="legend-color" style="border-color:#3b82f6;"></div> å¥‘ç´„</div>
    <div class="legend-item"><div class="legend-color" style="border-color:#f97316;"></div> æ³•ä»¤</div>
    <div class="legend-item"><div class="legend-color" style="border-color:#ef4444;"></div> ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</div>
    <div class="legend-item"><div class="legend-color" style="border-color:#8b5cf6;"></div> èª¿é”</div>
    <div class="legend-item"><div class="legend-color" style="border-color:#06b6d4;"></div> è¨­å‚™</div>
    <div class="legend-item"><div class="legend-color" style="border-color:#f59e0b;"></div> æ¤œæŸ»</div>
    <div class="legend-item"><div class="legend-color" style="border-color:#10b981;"></div> ç™»è¨˜</div>
    <div class="legend-item"><div class="legend-color" style="border-color:#ec4899;"></div> å¼•æ¸¡</div>
    <div class="legend-item"><div class="legend-color" style="border-color:#eab308;"></div> é›»åŠ›</div>
    <div class="legend-item"><div class="legend-color" style="border-color:#78716c;"></div> å»ƒæ£„ç‰©</div>
  </div>
</div>

<script>
    const MAINLINE_Y = 750;

    // ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã®å®šç¾©ï¼ˆç€å·¥ã‹ã‚‰ã‚¹ãƒã‚¨ãƒŠã¸QBéµé€ä»˜ã¾ã§ï¼‰
    const mainFlow = [
      { id:"n14", x:1000, depth:-50 },    // ç€å·¥ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ä¸Šï¼‰
      { id:"n16", x:1400, depth:120 },  // æç´å…¥
      { id:"n15", x:1500, depth:-50 },    // ä¸­é–“é‡‘æ›¸é¡ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ä¸Šï¼‰
      { id:"n20", x:1750, depth:140 },  // QBç´å…¥
      { id:"n18", x:2000, depth:0 },    // å·¥äº‹ä¸­ä¸»æŠ€ã¨å¥‘ç´„ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ä¸Šï¼‰
      { id:"n19", x:2250, depth:160 },  // ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¤œæŸ»
      { id:"n22", x:2500, depth:120 },  // ã‚«ãƒ¡ãƒ©ç”¨SDã‚«ãƒ¼ãƒ‰æ‰‹é…
      { id:"n23", x:2750, depth:140 },  // æ¨™è­˜ãƒ»çœ‹æ¿æ‰‹é…
      { id:"n24", x:3000, depth:160 },  // æ°—è±¡è¨ˆæ¸¬å™¨æ‰‹é…
      { id:"n26", x:3250, depth:180 },  // æ°—è±¡è¨ˆæ¸¬å™¨ä¿è¨¼æ›¸ç™ºè¡Œä¾é ¼
      { id:"n29", x:3500, depth:140 },  // ã‚¹ãƒãƒ¼ãƒˆãƒ­ã‚¬ãƒ¼SIMæ‰‹é…
      { id:"n28", x:3750, depth:160 },  // ç›£è¦–ã‚«ãƒ¡ãƒ©æ‰‹é…
      { id:"n32", x:4000, depth:120 },  // ã‚«ãƒ¡ãƒ©ç”¨SDã‚«ãƒ¼ãƒ‰ ã‚¹ãƒãƒ¼ãƒˆãƒ­ã‚¬ãƒ¼SIMé€ä»˜
      { id:"n30", x:4250, depth:140 },  // æ©Ÿæ¢°çš„å®Œå·¥è©¦é¨“
      { id:"n31", x:4500, depth:0 },    // æ©Ÿæ¢°çš„å®Œå·¥æ›¸é¡ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ä¸Šï¼‰
      { id:"n33", x:4750, depth:120 },  // ç«£å·¥æ¤œæŸ»
      { id:"n38", x:5000, depth:140 },  // å—é›»
      { id:"n36", x:5250, depth:160 },  // ä½¿ç”¨å‰è‡ªå·±ç¢ºèª
      { id:"n40", x:5500, depth:120 },  // æ€§èƒ½è©¦é¨“
      { id:"n46", x:5750, depth:140 },  // ä¿å®‰ç›£ç£éƒ¨å±Šå‡º
      { id:"n44b", x:6000, depth:100 }, // ä¿å®‰ç›£ç£éƒ¨å—ç†
      { id:"n48", x:6250, depth:0 },    // é›»æ°—çš„å®Œå·¥å¼•æ¸¡æ›¸é¡ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ä¸Šï¼‰
      { id:"n42", x:6500, depth:120 },  // BrONæ—¥æ™‚é€£çµ¡
      { id:"n50", x:6750, depth:0 },    // å¼•æ¸¡BrONï¼ˆãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ä¸Šï¼‰
      { id:"n51", x:7000, depth:0 }     // ã‚¹ãƒã‚¨ãƒŠã¸QBéµé€ä»˜ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ä¸Šï¼‰
    ];

    const data = [
      { id:"n1",  label:"H-EE å¥‘ç´„", x:50,  y:475, cat:"contract", icon:"ğŸ“", link:"https://example.com/placeholder" },
      { id:"n2",  label:"EE- åœ°æ¨©è€… åœŸåœ°å¥‘ç´„", x:300, y:50, cat:"contract", icon:"ğŸ“", link:"https://example.com/placeholder" },
      { id:"n3",  label:"EE-EPC å·¥äº‹è«‹è² å¥‘ç´„", x:300, y:900, cat:"contract", icon:"ğŸ“", link:"https://example.com/placeholder" },
      { id:"n4",  label:"é–¢ä¿‚æ³•ä»¤æ‰‹ç¶š", x:550, y:200, cat:"legal", icon:"âš–ï¸", link:"https://example.com/placeholder" },
      
      // é–¢ä¿‚æ³•ä»¤æ‰‹ç¶šã‹ã‚‰ä¸‹ã¸ä¼¸ã³ã‚‹ãƒãƒ–ãƒã‚¤ãƒ³ãƒˆï¼ˆé€æ˜ãªãƒ€ãƒŸãƒ¼ãƒãƒ¼ãƒ‰ã€Yåº§æ¨™èª¿æ•´ï¼‰
      { id:"n4b", label:"", x:750, y:400, cat:"hub", icon:"", link:"" },
      
      // ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã®ã‚«ãƒ¼ãƒ‰ï¼ˆå…ˆã«å®šç¾©ï¼‰
      { id:"n14", label:"ç€å·¥", x:1000, y:700, cat:"milestone", icon:"ğŸ› ï¸", link:"https://example.com/placeholder" },
      { id:"n16", label:"æç´å…¥", x:1250, y:420, cat:"procurement", icon:"ğŸ“¦", link:"https://example.com/placeholder" },
      { id:"n15", label:"ä¸­é–“é‡‘æ›¸é¡", x:1500, y:700, cat:"milestone", icon:"ğŸ’°", link:"https://example.com/placeholder" },
      { id:"n20", label:"QBç´å…¥", x:1750, y:440, cat:"equipment", icon:"ğŸ“¦", link:"https://example.com/placeholder" },
      { id:"n18", label:"å·¥äº‹ä¸­ä¸»æŠ€ã¨å¥‘ç´„", x:2000, y:300, cat:"contract", icon:"ğŸ“", link:"https://example.com/placeholder" },
      { id:"n19", label:"ãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¤œæŸ»", x:2250, y:460, cat:"inspection", icon:"ğŸ”", link:"https://example.com/placeholder" },
      { id:"n22", label:"ã‚«ãƒ¡ãƒ©ç”¨SDã‚«ãƒ¼ãƒ‰æ‰‹é…", x:2500, y:420, cat:"equipment", icon:"ğŸ“·", link:"https://example.com/placeholder" },
      { id:"n23", label:"æ¨™è­˜ãƒ»çœ‹æ¿æ‰‹é…", x:2750, y:440, cat:"equipment", icon:"ğŸª§", link:"https://example.com/placeholder" },
      { id:"n24", label:"æ°—è±¡è¨ˆæ¸¬å™¨æ‰‹é…", x:3000, y:460, cat:"equipment", icon:"ğŸŒ¡ï¸", link:"https://example.com/placeholder" },
      { id:"n26", label:"æ°—è±¡è¨ˆæ¸¬å™¨ä¿è¨¼æ›¸ç™ºè¡Œä¾é ¼", x:3250, y:480, cat:"equipment", icon:"ğŸ“", link:"https://example.com/placeholder" },
      { id:"n29", label:"ã‚¹ãƒãƒ¼ãƒˆãƒ­ã‚¬ãƒ¼SIMæ‰‹é…", x:3500, y:440, cat:"equipment", icon:"ğŸ“±", link:"https://example.com/placeholder" },
      { id:"n28", label:"ç›£è¦–ã‚«ãƒ¡ãƒ©æ‰‹é…", x:3750, y:460, cat:"equipment", icon:"ğŸ“¹", link:"https://example.com/placeholder" },
      { id:"n32", label:"ã‚«ãƒ¡ãƒ©ç”¨SDã‚«ãƒ¼ãƒ‰ ã‚¹ãƒãƒ¼ãƒˆãƒ­ã‚¬ãƒ¼SIMé€ä»˜", x:4000, y:420, cat:"equipment", icon:"ğŸ“¦", link:"https://example.com/placeholder" },
      { id:"n30", label:"æ©Ÿæ¢°çš„å®Œå·¥è©¦é¨“", x:4250, y:440, cat:"inspection", icon:"ğŸ”§", link:"https://example.com/placeholder" },
      { id:"n31", label:"æ©Ÿæ¢°çš„å®Œå·¥æ›¸é¡", x:4500, y:300, cat:"milestone", icon:"ğŸ“", link:"https://example.com/placeholder" },
      { id:"n33", label:"ç«£å·¥æ¤œæŸ»", x:4750, y:420, cat:"inspection", icon:"âœ…", link:"https://example.com/placeholder" },
      { id:"n38", label:"å—é›»", x:5000, y:440, cat:"power", icon:"âš¡", link:"https://example.com/placeholder" },
      { id:"n36", label:"ä½¿ç”¨å‰è‡ªå·±ç¢ºèª", x:5250, y:460, cat:"inspection", icon:"ğŸ“‹", link:"https://example.com/placeholder" },
      { id:"n40", label:"æ€§èƒ½è©¦é¨“", x:5500, y:420, cat:"inspection", icon:"ğŸ“ˆ", link:"https://example.com/placeholder" },
      { id:"n46", label:"ä¿å®‰ç›£ç£éƒ¨å±Šå‡º", x:5750, y:440, cat:"legal", icon:"ğŸ“¤", link:"https://example.com/placeholder" },
      { id:"n44b", label:"ä¿å®‰ç›£ç£éƒ¨å—ç†", x:6000, y:400, cat:"legal", icon:"âœ…", link:"https://example.com/placeholder" },
      { id:"n48", label:"é›»æ°—çš„å®Œå·¥å¼•æ¸¡æ›¸é¡", x:6250, y:300, cat:"milestone", icon:"ğŸ“", link:"https://example.com/placeholder" },
      { id:"n42", label:"BrONæ—¥æ™‚é€£çµ¡", x:6500, y:420, cat:"handover", icon:"ğŸ“…", link:"https://example.com/placeholder" },
      { id:"n50", label:"å¼•æ¸¡BrON", x:6750, y:300, cat:"handover", icon:"ğŸ‰", link:"https://example.com/placeholder" },
      { id:"n51", label:"ã‚¹ãƒã‚¨ãƒŠã¸QBéµé€ä»˜", x:7000, y:300, cat:"handover", icon:"ğŸ”‘", link:"https://example.com/placeholder" },
      
      // æ³•ä»¤æ‰‹ç¶šã®4åˆ†å²ï¼ˆXåº§æ¨™ã‚’5åˆ†å²ã¨æƒãˆã‚‹ï¼šå·¦æƒãˆï¼‰
      { id:"n5",  label:"ä½æ°‘èª¬æ˜ä¼š", x:750, y:400, cat:"legal", icon:"ğŸ‘¥", link:"https://example.com/placeholder" },
      { id:"n6",  label:"è¾²è»¢è¨±å¯å–å¾—", x:750, y:520, cat:"legal", icon:"âš–ï¸", link:"https://example.com/placeholder" },
      { id:"n7",  label:"å»ºç¯‰ãƒªã‚µã‚¤ã‚¯ãƒ«å±Š", x:750, y:640, cat:"legal", icon:"â™»ï¸", link:"https://example.com/placeholder" },
      { id:"n8",  label:"æ¶ˆé˜²å±Š", x:750, y:760, cat:"legal", icon:"ğŸš’", link:"https://example.com/placeholder" },
      
      // EPCå¥‘ç´„ã®5åˆ†å²ï¼ˆé–“éš”ã‚’åºƒã’ã‚‹ï¼š120pxé–“éš”ï¼‰
      { id:"n9",  label:"ç€å·¥å‰æ›¸é¡", x:750, y:900, cat:"milestone", icon:"ğŸ“‹", link:"https://example.com/placeholder" },
      { id:"n10", label:"æç™ºæ³¨", x:750, y:1020, cat:"procurement", icon:"ğŸ›’", link:"https://example.com/placeholder" },
      { id:"n11", label:"ã‚­ãƒ¥ãƒ¼ãƒ“ã‚¯ãƒ«ã‚«ã‚® ãƒ¡ãƒ¼ã‚«ãƒ¼ã¸é€ä»˜", x:750, y:1140, cat:"equipment", icon:"ğŸ”‘", link:"https://example.com/placeholder" },
      { id:"n12", label:"SSE ç”£å»ƒå¥‘ç´„ï¼ˆç¾å ´å…±æœ‰ï¼‰", x:750, y:1260, cat:"waste", icon:"ğŸ—‘ï¸", link:"https://example.com/placeholder" },
      { id:"n13", label:"é›»åŠ›ä»•æ§˜ãƒ»åç¾©å¤‰æ›´ EPC-EE", x:750, y:1380, cat:"power", icon:"âš¡", link:"https://example.com/placeholder" },
      
      // ç™»è¨˜ãƒ©ã‚¤ãƒ³ï¼ˆä¸Šéƒ¨ï¼‰
      { id:"n34", label:"åœ°ç›®å¤‰æ›´", x:800, y:50, cat:"registration", icon:"ğŸï¸", link:"https://example.com/placeholder" },
      { id:"n37", label:"ç§»è»¢ç™»è¨˜ åœ°æ¨©è€…â†’EE", x:1300, y:50, cat:"registration", icon:"ğŸ“‘", link:"https://example.com/placeholder" },
      { id:"n41", label:"ç§»è»¢ç™»è¨˜ EEâ†’H", x:1800, y:50, cat:"registration", icon:"ğŸ“‘", link:"https://example.com/placeholder" },
      { id:"n45", label:"ç™»è¨˜å®Œäº†", x:2300, y:50, cat:"registration", icon:"âœ…", link:"https://example.com/placeholder" },
      { id:"n47", label:"æ³•ä»¤é–¢ä¿‚ åç¾©å¤‰æ›´æ‰‹ç¶š", x:6000, y:150, cat:"legal", icon:"âš–ï¸", link:"https://example.com/placeholder" },
      { id:"n49", label:"åœŸåœ°ç™»è¨˜å®Œäº†è³‡æ–™ åŸæœ¬éƒµé€å¿…è¦æ›¸é¡", x:2800, y:50, cat:"registration", icon:"âœ‰ï¸", link:"https://example.com/placeholder" },
      
      // å—é›»ã‹ã‚‰ã®åˆ†å²
      { id:"n35", label:"ã‚¹ãƒã‚¨ãƒŠã« FusionSolar è¨­å®šä¾é ¼", x:5050, y:700, cat:"equipment", icon:"ğŸ–¥ï¸", link:"https://example.com/placeholder" },
      { id:"n43", label:"å…±æœ‰", x:5300, y:700, cat:"handover", icon:"ğŸ“¤", link:"https://example.com/placeholder" },
      { id:"n39", label:"ã‚¹ãƒã‚¨ãƒŠã¨ã‚«ãƒ¡ãƒ©è¨­å®šå¾®èª¿æ•´", x:5050, y:850, cat:"equipment", icon:"ğŸ”§", link:"https://example.com/placeholder" },
      
      // é›»åŠ›ãƒ©ã‚¤ãƒ³ï¼ˆä¸‹éƒ¨ï¼‰- ä¿®æ­£ç‰ˆ
      { id:"n21", label:"é›»åŠ›åç¾©å¤‰æ›´ EE-H", x:1200, y:1380, cat:"power", icon:"âš¡", link:"https://example.com/placeholder" },
      { id:"n25", label:"å—é›»æ—¥ãƒ»ç™ºèª¿é–‹å§‹æ—¥æ±ºå®š", x:2200, y:1380, cat:"power", icon:"ğŸ“…", link:"https://example.com/placeholder" },
      { id:"n27", label:"ç™ºèª¿ç”³è¾¼ Eãƒ»FLow ã¨æ‰“åˆã›", x:3200, y:1380, cat:"power", icon:"âš¡", link:"https://example.com/placeholder" },
      
      // ç”£å»ƒã‚µãƒ–ãƒ•ãƒ­ãƒ¼ï¼ˆSSEç”£å»ƒå¥‘ç´„ã¨é«˜ã•ã‚’åˆã‚ã›ã‚‹ï¼‰
      { id:"n17", label:"ç”£å»ƒãƒãƒƒã‚«ãƒ³èª¿æ•´", x:1250, y:1260, cat:"waste", icon:"â™»ï¸", link:"https://example.com/placeholder" },
      { id:"n47b", label:"ãƒãƒƒã‚«ãƒ³å›åæ—¥ æ±ºå®šé€£çµ¡", x:1800, y:1260, cat:"waste", icon:"ğŸ“…", link:"https://example.com/placeholder" },
    ];

    // ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã®Yåº§æ¨™ã‚’è¨ˆç®—ï¼ˆæ—¢ã«å®šç¾©æ¸ˆã¿ãªã®ã§åº§æ¨™ã®ã¿æ›´æ–°ï¼‰
    mainFlow.forEach(item => {
      const node = data.find(n => n.id === item.id);
      if (node) {
        node.x = item.x;
        node.y = MAINLINE_Y + item.depth;
      }
    });

    const edges = [
      // åˆæœŸåˆ†å²ï¼ˆH-EEå¥‘ç´„ã‹ã‚‰2åˆ†å²ï¼‰
      {from:"n1", to:"n2"},
      {from:"n1", to:"n3"},
      
      // EE-åœ°æ¨©è€… åœŸåœ°å¥‘ç´„ã‹ã‚‰2åˆ†å²
      {from:"n2", to:"n4"},
      {from:"n2", to:"n34"},
      
      // é–¢ä¿‚æ³•ä»¤æ‰‹ç¶šã‹ã‚‰ã®æ¥ç¶š
      // 1. æ°´å¹³ã«æ³•ä»¤é–¢ä¿‚åç¾©å¤‰æ›´æ‰‹ç¶šã¸
      {from:"n4", to:"n47"},
      // 2. å‚ç›´â†’ç›´è§’â†’æ°´å¹³åˆ†å²
      {from:"n4", to:"n4b", type:"vertical-then-horizontal"},
      {from:"n4b", to:"n5", type:"vertical-branch"},
      {from:"n4b", to:"n6", type:"vertical-branch"},
      {from:"n4b", to:"n7", type:"vertical-branch"},
      {from:"n4b", to:"n8", type:"vertical-branch"},
      {from:"n5", to:"n14"},
      {from:"n6", to:"n14"},
      {from:"n7", to:"n14"},
      {from:"n8", to:"n14"},
      
      // EPCå·¥äº‹è«‹è² å¥‘ç´„ã‹ã‚‰5åˆ†å² â†’ ç€å·¥ã¸ï¼ˆç”£å»ƒä»¥å¤–ï¼‰
      {from:"n3", to:"n9"},
      {from:"n3", to:"n10"},
      {from:"n3", to:"n11"},
      {from:"n3", to:"n12"},
      {from:"n3", to:"n13"},
      {from:"n9", to:"n14"},
      {from:"n10", to:"n14"},
      {from:"n11", to:"n14"},
      {from:"n13", to:"n14"},
      
      // ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼
      {from:"n14", to:"n16"},
      {from:"n16", to:"n15"},
      {from:"n15", to:"n20"},
      {from:"n20", to:"n18"},
      {from:"n18", to:"n19"},
      {from:"n19", to:"n22"},
      {from:"n22", to:"n23"},
      {from:"n23", to:"n24"},
      {from:"n24", to:"n26"},
      {from:"n26", to:"n29"},
      {from:"n29", to:"n28"},
      {from:"n28", to:"n32"},
      {from:"n32", to:"n30"},
      {from:"n30", to:"n31"},
      {from:"n31", to:"n33"},
      {from:"n33", to:"n38"},
      {from:"n38", to:"n36"},
      {from:"n36", to:"n40"},
      {from:"n40", to:"n46"},
      {from:"n46", to:"n44b"},
      {from:"n44b", to:"n48"},
      {from:"n48", to:"n42"},
      {from:"n42", to:"n50"},
      {from:"n50", to:"n51"},
      
      // å—é›»ã‹ã‚‰åˆ†å²
      {from:"n38", to:"n35"},
      {from:"n35", to:"n43"},
      {from:"n38", to:"n39"},
      
      // ç™»è¨˜ãƒ©ã‚¤ãƒ³ï¼ˆEE-åœ°æ¨©è€…ã‹ã‚‰åˆ†å²æ¸ˆã¿ï¼‰
      {from:"n34", to:"n37"},
      {from:"n37", to:"n41"},
      {from:"n41", to:"n45"},
      {from:"n45", to:"n47"},
      {from:"n45", to:"n49"},
      {from:"n49", to:"n51"},
      
      // é›»åŠ›ãƒ©ã‚¤ãƒ³ï¼ˆä¿®æ­£ç‰ˆï¼‰
      {from:"n13", to:"n21"},
      {from:"n21", to:"n25"},
      {from:"n25", to:"n27"},
      {from:"n27", to:"n48"},  // é›»æ°—çš„å®Œå·¥å¼•æ¸¡æ›¸é¡ã¸åˆæµ
      
      // ç”£å»ƒãƒ©ã‚¤ãƒ³ï¼ˆã‚µãƒ–ãƒ•ãƒ­ãƒ¼ï¼‰
      {from:"n12", to:"n17"},
      {from:"n17", to:"n47b"},
      {from:"n47b", to:"n48"},
    ];

    const canvas = document.getElementById("canvas");
    const svg = document.getElementById("edgesSvg");

    let scale = 0.6, tx = 50, ty = 50, isPanning=false, sx=0, sy=0;
    function applyTransform(){ canvas.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`; }
    applyTransform();

    document.getElementById("zoomIn").onclick = () => { scale=Math.min(2.5, scale+0.1); applyTransform(); };
    document.getElementById("zoomOut").onclick = () => { scale=Math.max(0.3, scale-0.1); applyTransform(); };
    document.getElementById("reset").onclick = () => { scale=0.6; tx=50; ty=50; applyTransform(); };

    canvas.addEventListener("mousedown", e => { isPanning=true; sx=e.clientX-tx; sy=e.clientY-ty; });
    window.addEventListener("mousemove", e => { if(!isPanning) return; tx=e.clientX-sx; ty=e.clientY-sy; applyTransform(); });
    window.addEventListener("mouseup", () => isPanning=false);

    const W = 7500, H = 1600;
    svg.setAttribute("width", W);
    svg.setAttribute("height", H);

    // ãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚’æç”»
    const mainlineStart = mainFlow[0].x + 90;
    const mainlineEnd = mainFlow[mainFlow.length-1].x + 90;
    const mainlinePath = document.createElementNS("http://www.w3.org/2000/svg","path");
    mainlinePath.setAttribute("class","mainline");
    mainlinePath.setAttribute("d", `M ${mainlineStart} ${MAINLINE_Y} L ${mainlineEnd} ${MAINLINE_Y}`);
    svg.appendChild(mainlinePath);

    const nodeEls = new Map();
    const nodeToEdges = new Map();

    data.forEach((d) => {
      // ãƒ€ãƒŸãƒ¼ãƒãƒ¼ãƒ‰ï¼ˆãƒ©ãƒ™ãƒ«ãŒç©ºï¼‰ã¯ã‚¹ã‚­ãƒƒãƒ—
      if (!d.label) {
        nodeEls.set(d.id, null);
        nodeToEdges.set(d.id, []);
        return;
      }
      
      const el = document.createElement("div");
      el.className = `node cat-${d.cat}`;
      el.dataset.id = d.id;
      el.style.left = d.x + "px";
      el.style.top  = d.y + "px";
      el.innerHTML = `
        <div class="node-icon">${d.icon}</div>
        <h4>${d.label}
          <span class="tooltip">è©³ç´°èª¬æ˜ï¼ˆä»®ï¼‰</span>
        </h4>
      `;
      el.onclick = () => window.open(d.link, "_blank");
      canvas.appendChild(el);
      nodeEls.set(d.id, el);
      nodeToEdges.set(d.id, []);
    });

    // ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã®ã¶ã‚‰ä¸‹ãŒã‚Šç·šã‚’æç”»ï¼ˆLå­—å‹: å‚ç›´â†’æ°´å¹³ï¼‰
    mainFlow.forEach((item, idx) => {
      const node = nodeEls.get(item.id);
      if (!node || item.depth === 0) return;

      const edgeId = `hanging_${item.id}`;
      const nodeX = item.x;
      const nodeY = MAINLINE_Y + item.depth;
      
      // ãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ä¸Šã‹ã‚‰å‚ç›´ã«é™ã‚Šã‚‹ä½ç½®ï¼ˆã‚«ãƒ¼ãƒ‰ä¸­å¤®ï¼‰
      const dropX = nodeX + 90;
      
      // Lå­—å‹æ¥ç¶š: ãƒ¡ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ â†’ å‚ç›´ã«é™ã‚Šã‚‹ â†’ æ°´å¹³ã«å·¦ã¸ â†’ ã‚«ãƒ¼ãƒ‰å³ç«¯
      const pathD = `M ${dropX} ${MAINLINE_Y} L ${dropX} ${nodeY + 40} L ${nodeX + 180} ${nodeY + 40}`;
      
      const path = document.createElementNS("http://www.w3.org/2000/svg","path");
      path.setAttribute("id", edgeId);
      path.setAttribute("class","hanging");
      path.setAttribute("d", pathD);
      svg.appendChild(path);
      
      const prevItem = mainFlow[idx - 1];
      if (prevItem) {
        nodeToEdges.get(prevItem.id).push(edgeId);
      }
    });

    // é€šå¸¸ã®ã‚¨ãƒƒã‚¸æç”»ï¼ˆç›´è§’æ¥ç¶šï¼‰
    edges.forEach((e, idx) => {
      const edgeId = `e${idx}`;
      
      // fromã¨toã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆãƒ€ãƒŸãƒ¼ãƒãƒ¼ãƒ‰ã‚‚dataã‹ã‚‰ï¼‰
      const fromData = data.find(d => d.id === e.from);
      const toData = data.find(d => d.id === e.to);
      if (!fromData || !toData) return;
      
      // fromåº§æ¨™ï¼ˆä¸­å¿ƒã‹ã‚‰å³ç«¯ï¼‰
      const fx = fromData.x + 90;  // ã‚«ãƒ¼ãƒ‰ä¸­å¿ƒ
      const fy = fromData.y + 40;  // ã‚«ãƒ¼ãƒ‰å‚ç›´ä¸­å¿ƒ
      
      // toåº§æ¨™ï¼ˆå·¦ç«¯ï¼‰
      const tx = toData.x;
      const ty = toData.y + 40;  // ã‚«ãƒ¼ãƒ‰å‚ç›´ä¸­å¿ƒ

      let pathD;
      let edgeClass = "edge";
      
      // ç‰¹æ®Šãªæ¥ç¶šã‚¿ã‚¤ãƒ—
      if (e.type === "vertical-then-horizontal") {
        // å‚ç›´â†’æ°´å¹³ã®ç›´è§’: fromã®ä¸­å¿ƒä¸‹ç«¯ â†’ å‚ç›´ã«é™ã‚Šã‚‹ â†’ å³ã«æ›²ãŒã‚‹
        const hubX = toData.x;  // ãƒãƒ–ãƒã‚¤ãƒ³ãƒˆX
        const hubY = toData.y;  // ãƒãƒ–ãƒã‚¤ãƒ³ãƒˆY
        pathD = `M ${fx} ${fy} L ${fx} ${hubY} L ${hubX} ${hubY}`;
        edgeClass = "edge";
      } else if (e.type === "vertical-branch") {
        // å‚ç›´åˆ†å²: ãƒãƒ–ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰å‚ç›´ç·šâ†’æ°´å¹³ç·šã§ã‚«ãƒ¼ãƒ‰ã¸
        const hubX = fromData.x;  // ãƒãƒ–ãƒã‚¤ãƒ³ãƒˆX
        const hubY = fromData.y;  // ãƒãƒ–ãƒã‚¤ãƒ³ãƒˆY
        pathD = `M ${hubX} ${hubY} L ${hubX} ${ty} L ${tx} ${ty}`;
        edgeClass = "edge";
      } else {
        // é€šå¸¸ã®ç›´è§’æ¥ç¶š
        const midX = fx + (tx - fx) / 2;
        
        if (Math.abs(tx - fx) < 50) {
          pathD = `M ${fx} ${fy} L ${tx} ${ty}`;
        } else {
          pathD = `M ${fx} ${fy} L ${midX} ${fy} L ${midX} ${ty} L ${tx} ${ty}`;
        }
      }

      const path = document.createElementNS("http://www.w3.org/2000/svg","path");
      path.setAttribute("id", edgeId);
      path.setAttribute("class", edgeClass);
      path.setAttribute("d", pathD);
      svg.appendChild(path);

      if (nodeToEdges.has(e.from)) {
        nodeToEdges.get(e.from).push(edgeId);
      }
    });

    // ãƒ›ãƒãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
    document.querySelectorAll(".node").forEach(node => {
      node.addEventListener("mouseenter", () => {
        const nodeId = node.dataset.id;
        const edgeIds = nodeToEdges.get(nodeId) || [];
        edgeIds.forEach(eid => {
          document.getElementById(eid)?.classList.add("active");
        });
      });
      node.addEventListener("mouseleave", () => {
        document.querySelectorAll(".edge, .hanging").forEach(e => e.classList.remove("active"));
      });
    });
  </script>
</body>
</html>
                                                                                                                                                                                                                                       